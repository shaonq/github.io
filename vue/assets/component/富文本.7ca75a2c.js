import{Q as t}from"../quill/quill.13eb9602.js";import{_ as e}from"../index.56e2a9af.js";import{k as n,v as l,I as s,J as i,x as o,F as r,K as a,L as u,M as c,y as d,H as h}from"../@vue/@vue.a9907412.js";import"../mockjs/mockjs.69e5819b.js";import"../vue-router/vue-router.30f59dce.js";import"../pinia/pinia.2d6c69fe.js";import"../vue-demi/vue-demi.784001c0.js";import"../shaonq/shaonq.e47bfeb9.js";import"../vite-plugin-mock/vite-plugin-mock.5f58db78.js";import"../path-to-regexp/path-to-regexp.dea237f3.js";const p=t.import("blots/block/embed"),b=t.import("formats/link");class m extends p{static create(t){const e=super.create();return e.setAttribute("contenteditable",!1),e.setAttribute("tabindex",1),e.innerHTML=t,e.onkeydown=t=>{46!==t.keyCode&&8!==t.keyCode||e.parentNode.removeChild(e)},e}static value(t){return t.innerHTML}}m.blotName="figure",m.tagName="figure",t.register(m);class g extends b{static create(t){let e;return t&&!t.href?e=super.create(t):(e=super.create(t.href),e.href=t.href,e.innerText=t.innerText),e}}g.blotName="newLink",g.tagName="A",t.register(g);const y={props:["readonly","html","type","handlers"],computed:{isHandlers(){return!!Object.keys(this.handlers).length}},watch:{html(t){this.setHtml(t)}},mounted(){const{editorEl:e,toolbarEl:n}=this.$refs,l=this.html||e.innerText,s=this.quill=new t(e,{modules:{toolbar:{container:n,handlers:{clear:t=>{const e=s.getSelection();s.removeFormat(e.index,e.length)},divider:t=>{s.insertEmbed(s.getSelection().index,"figure","<hr>"),s.setSelection(s.getSelection(!0).index+1)},image:t=>{const{index:e}=s.getSelection();this.handlers.image((t=>{s.insertEmbed(e,"figure",`<img src="${t}">`),s.setSelection(s.getSelection(!0).index+1),s.focus()}))},link:t=>{s.getSelection(),this.handlers.link((t=>{const e=s.getSelection(!0);s.insertEmbed(e.index,"newLink",{href:t,innerText:t},"api"),s.setSelection(e.index+t.length)}))}}}},readOnly:this.readonly,placeholder:"请输入内容"});l&&this.setHtml(l),s.on("text-change",(t=>{if("json"===this.type){const t=s.getContents();this.$emit("change",JSON.stringify(t),s)}else"html"===this.type?this.$emit("change",s.root.innerHTM,s):this.$emit("change",s.getText(),s)})),s.on("selection-change",((t,e,n)=>{this.$emit("selection",t,s)}))},methods:{setHtml(t){const{type:e,quill:n}=this;if("html"===e)n.pasteHTML(t);else if("json"===e)try{"object"!=typeof t&&(t=JSON.parse(t)),n.setContents(t)}catch(l){n.setText(t)}else n.setText(t)}}},f={class:"u-quill"},k={ref:"toolbarEl",class:"u-quill-toolbar"},v=c('<button class="ql-bold" title="粗体(Ctrl+B)" type="button"></button><button class="ql-italic" title="斜体 (Ctrl+I)" type="button"></button><i></i><button class="ql-header" value="1" title="一级标题" type="button"></button><button class="ql-blockquote" title="引用块" type="button"></button><button class="ql-list" value="bullet" title="无序列表" type="button"></button><button class="ql-list" value="ordered" title="有序列表" type="button"></button><button class="ql-divider" title="分割线" type="button"></button>',8),x={key:0},q={key:1,class:"ql-link",title:"链接",type:"button"},j={key:2,class:"ql-image",title:"图片",type:"button"},S={key:3,class:"ql-video",title:"视频",type:"button"},T=o("i",null,null,-1),N=o("button",{class:"ql-clear",title:"清除格式",type:"button"},"",-1),C={ref:"editorEl",class:"u-quill-body u-scroll"};var H=e(y,[["render",function(t,e,c,d,h,p){return n(),l("div",f,[s(o("div",k,[c.readonly?a("",!0):(n(),l(r,{key:0},[v,p.isHandlers?(n(),l("i",x)):a("",!0),c.handlers.link?(n(),l("button",q,"")):a("",!0),c.handlers.image?(n(),l("button",j,"")):a("",!0),c.handlers.video?(n(),l("button",S,"")):a("",!0),T,N],64))],512),[[i,!c.readonly]]),o("div",C,[u(t.$slots,"default")],512)])}]]);const w=JSON.stringify({ops:[{insert:"佳人"},{attributes:{header:1},insert:"\n"},{attributes:{color:"#999999"},insert:" "},{attributes:{newLink:"#",color:"#999999"},insert:"【作者】"},{attributes:{newLink:"#",color:"#2673db"},insert:"杜甫 "},{attributes:{color:"#999999"},insert:"【朝代】"},{insert:"唐\n绝代有佳人，幽居在空谷。\n自云良家子，零落依草木。\n关中昔丧乱，兄弟遭杀戮。\n官高何足论，不得收骨肉。\n世情恶衰歇，万事随转烛。\n夫婿轻薄儿，新人美如玉。\n合昏尚知时，鸳鸯不独宿。\n"},{attributes:{color:"#cc0000"},insert:"但见新人笑，那闻旧人哭"},{insert:"。\n在山泉水清，出山泉水浊。\n侍婢卖珠回，牵萝补茅屋。\n摘花不插发，采柏动盈掬。\n天寒翠袖薄，日暮倚修竹。\n"}]}),$={data(){return{defaultJsonString:w,html:w,handlers:{link:t=>{const e=this.$util;e.alert({extend:!0,title:"添加链接",content:'<input class="u-input" placeholder="http(s)://"/>',success:(t,n)=>{e.dom.el("input",n).focus()},ok:{label:"确认",onclick:(n,l)=>{const s=e.dom.el("input",l.parentNode.parentNode).value;e.regexp.url.test(s)?(t(s),e.hideToast(n)):e.toast("请输入一个有效地址")}}})},image:t=>{const e=this.$util;e.alert({extend:!0,title:"添加图片",content:'<input class="u-input" placeholder="http(s)://"/>',success:(t,n)=>{e.dom.el("input",n).focus()},ok:{label:"确认",onclick:(n,l)=>{const s=e.dom.el("input",l.parentNode.parentNode).value;e.regexp.image.test(s)?(t(s),e.hideToast(n)):e.toast("请输入一个有效图片地址")}}})}}}},methods:{onChange(t){this.html=t}}},L=o("div",{class:"u-quill-body"},[o("h1",null,"富文本"),o("p",null,"轻量级基础富文本编辑器")],-1),E={class:"u-quill-body"},J=o("h1",null,"数据",-1);var M=e($,[["render",function(t,e,s,i,r,a){const u=H;return n(),l("div",null,[L,d(u,{handlers:r.handlers,style:{"min-height":"282px","border-right-width":"0","border-left-width":"0"},type:"json",html:r.defaultJsonString,onChange:a.onChange},null,8,["handlers","html","onChange"]),d(u,{handlers:r.handlers,html:r.html,style:{border:"0"},type:"json",readonly:"readonly"},null,8,["handlers","html"]),o("div",E,[J,o("pre",null,h(r.html),1)])])}]]);export{M as default};
