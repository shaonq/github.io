import{s as t}from"../shaonq/shaonq.e47bfeb9.js";import{_ as e}from"../index.56e2a9af.js";import{k as a,v as l,x as s,P as n,F as i,B as r,H as d,G as c,K as u,f as g,r as o,y as h}from"../@vue/@vue.a9907412.js";import{h as D}from"../request/request.7bd88e11.js";import"../vue-router/vue-router.30f59dce.js";import"../pinia/pinia.2d6c69fe.js";import"../vue-demi/vue-demi.784001c0.js";import"../vite-plugin-mock/vite-plugin-mock.5f58db78.js";import"../mockjs/mockjs.69e5819b.js";import"../path-to-regexp/path-to-regexp.dea237f3.js";import"../axios/axios.e13dbd1c.js";const m={ref:"gantt",class:"u-gantt"},f={class:"u-gantt-head"},p={class:"u-flex u-flex--start"},y={class:"u-gantt__scroll u-gantt---left"},x={class:"u-gantt-rows"},v={class:"u-gantt-cell"},b={class:"u-flex__item is-clamp"},k={class:"u-gantt__scroll u-gantt---right"},w={class:"u-gantt-bars"},_={class:"u-gantt-cell"},S=["title","textContent"],C={class:"u-gantt-warp",style:{height:"calc(100% - 50px)"}},j={class:"u-flex u-flex--start"},L={class:"u-gantt__scroll u-gantt---left"},R=["onClick"],I={class:"u-gantt-cell"},W={class:"u-flex__item is-clamp"},P={class:"u-gantt__scroll u-gantt---right"},N={class:"u-gantt-cell"},X=["title"],$=["onClick"],q={class:"u-gantt-actual__title"},A={class:"u-gantt-scroll"},O={class:"u-flex u-flex--start"},E={style:{height:"0"}},F={class:"u-gantt-rows"},H={class:"u-gantt-cell"},B={class:"u-flex__item is-clamp"},M={style:{height:"0"}},G={class:"u-gantt-bars"},K={class:"u-gantt-cell"},z=["title","textContent"];var J=e({props:{list:{type:Array,default:()=>[]},skin:{type:String,default:""},labelList:{type:Array,default:()=>[{label:"任务名称",value:"title",width:150},{label:"开始时间",value:"startDate",width:90},{label:"结束时间",value:"endDate",width:90}]}},data:()=>({dayPX:{width:33,height:33},sideWidth:360}),computed:{dateRange(){const e=t.date,a=Object.assign([],this.list).map((({startDate:t,endDate:e})=>[this.getDateNumber(t,!0),this.getDateNumber(e,!0)])),l=e.addDays(-1,e.toString(Math.min.apply(null,a.map((([t,e])=>t))))),s=e.addDays(1,e.toString(Math.max.apply(null,a.map((([t,e])=>e)))));return{minDate:l,maxDate:s,rangeDay:this.getDateDiff(s,l)}},dateRangeDay(){return this.dateRange.rangeDay>30?this.dateRange.rangeDay:30}},mounted(){const e=t.dom,a=this.$refs.gantt,l=e.el(".u-gantt-head",a).offsetHeight+e.el(".u-gantt-scroll",a).offsetHeight;e.el(".u-gantt-warp",a).style.height=a.offsetHeight-l+"px"},methods:{getDateNumber(e,a){let l;try{l=t.date.toDate(e)}catch(s){}return l||(l=a?new Date:0),+l},getDateDiff(e,a){const l=t.date;return e=this.getStringDate(e),a=this.getStringDate(a),(l.toDate(e)-l.toDate(a))/864e5+1},getIndexDate(e){return t.date.addDays(e,this.getStringDate(this.dateRange.minDate))},getStringDate:e=>e?"string"!=typeof e?t.date.toString(e):t.date.toString(t.date.toDate(e)):"",getDateWeekClass(e){const a=t.date.satOfWeek(e),l=t.date.sunOfWeek(e);return{"is-week":e===a||e===l}},headDateFromt:t=>+t.slice(-2),getBarStyle(t,e){if(this.getDateNumber(t.startDate)&&this.getDateNumber(t.endDate)){const a=this.getDateDiff(t.endDate,t.startDate);return{width:this.dayPX.width*(a<0?0:a)+"px",height:this.dayPX.height+"px",left:this.dayPX.width*e+"px"}}return!1},getActualStyle(t,e){const a=this.getDateNumber(t.actualStartDate),l=this.getDateNumber(t.actualEndDate,!0);if(a){const t=this.getDateDiff(l,a),e=this.getDateDiff(a,this.dateRange.minDate);if(t>0)return{width:this.dayPX.width*t+"px",height:this.dayPX.height+"px",left:this.dayPX.width*e+"px"}}return!1},scrollLeft(e){const a=e.target.scrollLeft;t.dom.els(".u-gantt---left",this.$refs.gantt).forEach((t=>{t.scrollLeft=a}))},scrollRight(e){const a=e.target.scrollLeft;t.dom.els(".u-gantt---right",this.$refs.gantt).forEach((t=>{t.scrollLeft=a}))}}},[["render",function(t,e,g,o,h,D){return a(),l("div",m,[s("div",f,[s("ul",p,[s("li",{style:n({width:h.sideWidth+"px"}),class:"is-clamp"},[s("div",y,[s("table",null,[s("thead",null,[s("tr",x,[(a(!0),l(i,null,r(g.labelList,((t,e)=>(a(),l("td",{key:e,style:n({width:t.width+"px"})},[s("div",v,d(t.label),1)],4)))),128))])])])])],4),s("li",b,[s("div",k,[s("table",null,[s("thead",null,[s("tr",w,[(a(!0),l(i,null,r(D.dateRangeDay,((t,e)=>(a(),l("td",{key:e,class:c(D.getDateWeekClass(D.getIndexDate(e)))},[s("div",_,[s("div",{title:D.getIndexDate(e),textContent:d(D.headDateFromt(D.getIndexDate(e)))},null,8,S)])],2)))),128))])])])])])])]),s("div",C,[s("ul",j,[s("li",{style:n({width:h.sideWidth+"px"}),class:"is-clamp"},[s("div",L,[s("table",null,[s("tbody",null,[(a(!0),l(i,null,r(g.list,((e,c)=>(a(),l("tr",{key:c,class:"u-gantt-rows",onClick:a=>t.$emit("on-item-click",e,a)},[(a(!0),l(i,null,r(g.labelList,(({value:t,width:i},r)=>(a(),l("td",{key:r,style:n({width:i+"px"})},[s("div",I,d(e[t]),1)],4)))),128))],8,R)))),128))])])])],4),s("li",W,[s("div",P,[s("table",null,[s("tbody",null,[(a(!0),l(i,null,r(g.list,((e,g)=>(a(),l("tr",{key:g,class:"u-gantt-bars"},[(a(!0),l(i,null,r(D.dateRangeDay,((r,g)=>(a(),l("td",{key:g,class:c(D.getDateWeekClass(D.getIndexDate(g)))},[s("div",N,[D.getIndexDate(g)===D.getStringDate(e.startDate)?(a(),l(i,{key:0},[s("div",{class:"u-gantt-bar",title:e.title+"\n"+e.startDate+"~"+e.endDate,style:n(D.getBarStyle(e,g))},[s("div",{class:"u-gantt-bar__title",onClick:a=>t.$emit("on-item-click",e,a)},d(e.title),9,$)],12,X),D.getActualStyle(e,g)?(a(),l("div",{key:0,class:"u-gantt-actual",style:n(D.getActualStyle(e,g))},[s("div",q,d(e.title),1)],4)):u("",!0)],64)):u("",!0)])],2)))),128))])))),128))])])])])])]),s("div",A,[s("ul",O,[s("li",{style:n({width:h.sideWidth+"px"}),class:"is-clamp"},[s("div",{class:"u-gantt__scroll",onScroll:e[0]||(e[0]=(...t)=>D.scrollLeft&&D.scrollLeft(...t))},[s("div",E,[s("table",null,[s("thead",null,[s("tr",F,[(a(!0),l(i,null,r(g.labelList,((t,e)=>(a(),l("td",{key:e,style:n({width:t.width+"px"})},[s("div",H,d(t.label),1)],4)))),128))])])])])],32)],4),s("li",B,[s("div",{class:"u-gantt__scroll",onScroll:e[1]||(e[1]=(...t)=>D.scrollRight&&D.scrollRight(...t))},[s("div",M,[s("table",null,[s("thead",null,[s("tr",G,[(a(!0),l(i,null,r(D.dateRangeDay,((t,e)=>(a(),l("td",{key:e,class:c(D.getDateWeekClass(D.getIndexDate(e)))},[s("div",K,[s("div",{title:D.getIndexDate(e),textContent:d(D.headDateFromt(D.getIndexDate(e)))},null,8,z)])],2)))),128))])])])])],32)])])])],512)}]]);const Q=g({setup(){const e=o([]);return async function(){const t=await D.get("/api/get-gantt-list");e.value=t.list}(),{list:e,handleClick(e){t.toast(`您点击了 ${e.title}`)}}}}),T=s("div",{class:"u-quill-body"},[s("h1",null,"甘特图"),s("pre",null,[s("code",{class:"language-javascript"},"\n// Mock 数据格式        \n{\n\t'title|1': [\n\t\t'1.@increment(1)协议或合同',\n\t\t'1.@increment(1)顾客特殊要求传递清单及工作任务单123',\n\t\t'1.@increment(1)新项目信息输入输出检查表',\n\t\t'1.@increment(1)新开发产品市场分析报告',\n\t\t'1.@increment(1)工程工作申请单',\n\t\t'1.@increment(1)产品成本核算表',\n\t\t'1.@increment(1)项目经验-以往缺陷清单',\n\t\t'1.@increment(1)产品设计方案评估报告',\n\t\t'1.@increment(1)注塑模具设计制造方案评估报告',\n\t\t'1.@increment(1)冲压模具设计制造方案评估报告',\n\t],\n\tendDate: '2020-10-@natural(16,31)',\n\tstartDate: '2020-10-@natural(1,10)',\n\tactualEndDate: '2020-10-@natural(16,31)',\n\tactualStartDate: '2020-10-@natural(1,10)',\n\t'dateList|0-3': [\n           { endDate: '2020-10-@natural(9,16)', startDate: '2020-10-@natural(1,8)' }\n\t],\n}\n      ")])],-1);var U=e(Q,[["render",function(t,e,n,i,r,d){const c=J;return a(),l("div",null,[T,s("div",null,[h(c,{list:t.list,style:{height:"380px"},class:"test-gantt",onOnItemClick:t.handleClick},null,8,["list","onOnItemClick"])])])}]]);export{U as default};
