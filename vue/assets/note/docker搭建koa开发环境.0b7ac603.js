import{_ as o}from"../index.6bcf6308.js";import{q as t,l as n,I as e}from"../@vue/@vue.89516255.js";import"../shaonq/shaonq.b69e9063.js";import"../vue-router/vue-router.c5b5117a.js";import"../pinia/pinia.5150f487.js";import"../vue-demi/vue-demi.784001c0.js";import"../nprogress/nprogress.18cafdd9.js";import"../quill/quill.3362dfa5.js";import"../echarts/echarts.22f0db08.js";import"../tslib/tslib.b9ce9c9f.js";import"../zrender/zrender.31b37330.js";import"../vite-plugin-mock/vite-plugin-mock.b4540423.js";import"../mockjs/mockjs.56624cf4.js";import"../path-to-regexp/path-to-regexp.dea237f3.js";const r={mounted(){}},s={class:"u-quill-body"},a=[e('<h1>docker搭建koa开发环境</h1><h1>工具安装</h1><ul><li>docker windows<a href="https://www.docker.com/products/docker-desktop" target="_blank">下载地址</a></li></ul><hr><ol><li><code>images: node:10.16.0 + nginx +mysql:5.6 </code></li><li><code>koa: koa + koa-router + mysql + promise-mysql</code></li><li><code>docker-compose</code></li></ol><figure contenteditable="false" tabindex="-1"><hr></figure><h1>根目录文件</h1><ul><li>server.js</li></ul><pre>const Koa = require(&#39;koa&#39;)\nconst Router = require(&#39;koa-router&#39;)\nconst mysql = require(&#39;promise-mysql&#39;)\nconst app = new Koa()\nconst router = new Router()\n\n// 根路由\nrouter.get(&#39;/&#39;, async ctx=&gt;{ctx.body = &#39;hello word&#39;});\n\n// 测试mysql连接路由\nrouter.get(&#39;/db&#39;, async ctx=&gt;{\nlet db = await mysql.createPool({\n\thost: &#39;mysql&#39;,\n\tport: 3306,\n\tuser: &#39;root&#39;,\n\tpassword: &#39;123456&#39;\n})\nlet res = await db.query(&#39;SHOW DATABASES&#39;)\nctx.body = res\n})\n\napp.use(router.routes())\napp.listen(3000)\n</pre><ul><li>package.json</li></ul><pre>{\n  &quot;name&quot;: &quot;docker-koa&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;description&quot;: &quot;&quot;,\n  &quot;main&quot;: &quot;index.js&quot;,\n  &quot;scripts&quot;: {\n    &quot;start&quot;: &quot;nodemon server.js&quot;\n  },\n  &quot;keywords&quot;: [],\n  &quot;author&quot;: &quot;shaonq&quot;,\n  &quot;license&quot;: &quot;MIT&quot;,\n  &quot;dependencies&quot;: {\n    &quot;koa&quot;: &quot;^2.13.1&quot;,\n    &quot;koa-router&quot;: &quot;^10.0.0&quot;,\n    &quot;nodemon&quot;: &quot;^2.0.12&quot;,\n    &quot;promise-mysql&quot;: &quot;^5.0.3&quot;\n  }\n}\n</pre><ul><li>.dockerignore</li></ul><pre>*.log\n.idea\n.node_modules\nnode_modules\n.vscode\n</pre><ul><li>docker-compose.yml</li></ul><pre>version: &quot;3&quot;\nservices:\n        koa:\n                image: node:10.16.0                          #node镜像名称\n                working_dir: /koa                            #工作目录的路径\n                build:                                       #构建镜像\n                     context: ./                            #上下文环境\n                     dockerfile: ./compose/koa.Dockerfile            #Dockerfile路径\n                volumes:                                     #挂载点 [格式] 本地文件:映射路径\n                        - .:/koa                             # \n                ports:                                       #端口映射\n                        - &quot;3000:3000&quot;                        #本地端口:容器端口\n                command: npm start #这条命令会在工作目录下执行\n        mysql:\n                image: mysql:5.6\n                volumes:\n                        - ./mysql:/var/lib/mysql\n                command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci\n                restart: always\n                environment:\n                        - MYSQL_ROOT_PASSWORD=123456         #root password \n                        - MYSQL_DATABASE=db_database\n                ports:\n                        - &quot;3306:3306&quot;\n        nginx:\n                image: nginx:latest\n                volumes:\n                        - ./static:/code/static\n                        - ./compose/nginx.conf:/etc/nginx/conf.d/default.conf\n                ports:\n                        - &quot;80:80&quot;\n</pre><ul><li>compose/nginx.conf</li></ul><pre>server {\n    listen       80;\n    server_name  localhost;\n\n    location /static {\n        alias /koa/static;             # 代理访问/koa/下的static\n    }\n\n    location / {\n        proxy_pass http://koa:3000;    #  docker-compose.yml koa\n    }\n}\n\t\t\t</pre><ul><li>compose/koa.Dockerfile</li></ul><pre>FROM node:10.16.0                       # 使用的基础镜像文件\nWORKDIR /koa                            # 工作目录的路径\nCOPY ./package.json ./server.js /koa/   # 拷贝文件到/koa\nCOPY ./static /koa/static               # 拷贝文件到/koa/static\nRUN sed -i &#39;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#39; /etc/apk/repositories \\\n\t&amp;&amp; apk update &amp;&amp; apk add yarn \\\n\t&amp;&amp; yarn config set registry https://registry.npm.taobao.org/ \\\n\t&amp;&amp; yarn       # 设置镜像源到国内, 更新; 安装yarn,yarn设置国内镜像源，安装依赖\nCMD [&quot;npm&quot;, &quot;start&quot;]  # 容器启动时运行\n\t\t\t</pre>',19)];var u=o(r,[["render",function(o,e,r,u,i,l){return n(),t("div",s,a)}]]);export{u as default};
