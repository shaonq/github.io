!function(){var e={type:{msg:function(e){var t='<div class="{{d.me}}"> \r\n                            <p>{{d.text}}</p>\r\n                         </div>',n={text:e.text,time:nui.util.date.now(),user:e.user||"佚名",img:e.img||"http://placeholder.qiniudn.com/40x40/ddd/ddd",me:e.me?"this":""};return nui.tpl(t,n)},zip:function(e){var t='<div class="{{d.me}}" type="zip"> \r\n                            <p><a href="{{d.text}}">下载</a></p>\r\n                         </div>',n={text:e.text,time:nui.util.date.now(),user:e.user||"佚名",img:e.img||"http://placeholder.qiniudn.com/40x40/ddd/ddd",me:e.me?"this":""};return nui.tpl(t,n)}}};var t=function(e){this.box=e.box};t.prototype.escape=function(e){return String(e||"").replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};t.prototype.send=function(t){var n=this.box;if(typeof t==="object"){t.type in e.type?n.append(e.type[t.type](t)):n.append(e.type.msg(t));var i=n[0];nui.animate(i.scrollTop,i.scrollHeight,function(e){i.scrollTop=e},"easeOut",1e3)}};t.prototype.ai=function(e,t){var n=[{text:"笑话",random:.6,func:"joke"}];var i={joke:function(){nui.http("https://bird.ioliu.cn/joke/rand",function(e){if(e.status.code===200){t(nui.tpl('<img src="{{d.url}}" draggable="false"><span style="padding: 10px;\r\n                        text-align: {{ (d.content.length>10?\'left\':\'center\') }};\r\n                        display: block;">{{d.content}}</span>',e.data[nui.util.randomSize(0,9)|0]))}else{i.all()}})},all:function(){nui.http("https://bird.ioliu.cn/v1?url=http://www.tuling123.com/openapi/api",{key:"71d42b94bc57459a9a99017b53377579",info:e},function(e){if(e&&e.text)t(e.text)})}};try{var r,a;for(a in n){if(!r){if(n[a].text.indexOf(e)!==-1&&(nui.util.randomSize(0,10)|0)/10<=n[a].random){i[n[a].func]();r=!0}else{i.all();r=!0}}}}catch(o){i.all()}};var n='<style>  \r\n            .__c{position:fixed;left:50%;top:50%;width:320px;margin-top:-240px;margin-left:-160px;height:430px;border-radius:0 0 3px 3px;overflow:hidden;box-shadow:0 4px 16px rgba(21,21,21,0.2);z-index: 999}\r\n            .__cc{height:5px;background-color:#f75b43}.__cc:hover{cursor:move}.__cc,.__ch,.__cb{position:relative;width:100%;box-sizing:border-box}\r\n            .__ch{height:340px;overflow-x:hidden;overflow-y:scroll;padding:10px 0 0;background-color:#eee}\r\n            .__cb{height:85px;background-color:#fff}.__ch>div>*{display:none}.__ch>div>p{max-width:280px;padding:9px 13px;background-color:#fff;min-height:1em;display:inline-block;vertical-align:top;position:relative;text-align:left;font-size:13px;border-radius:3px;color:#666;margin:5px 10px;animation:scale-in cubic-bezier(0.22,0.58,0.12,0.98) .5s}\r\n            .__ch>div>p:before{content:" ";position:absolute;top:12px;right:100%;border:6px solid transparent;border-right-color:#fafafa}\r\n            .__ch>div.this>p:before{right:auto;left:100%;border-right-color:transparent;border-left-color:#b2e281}\r\n            .__ch>div.this{text-align:right}.__ch>div.this p{background-color:#b2e281}.__cb a{margin-top:10px;margin-right:10px}\r\n            </style><div class="__c a-move-in-top"> <div class="__cc"></div><div class="__ch"> </div> <div class="__cb"> <div> <textarea class="nui-textarea nui-noborder" placeholder="按 Enter 发送"></textarea> <span  class="fr hide"><a class="nui-btn nui-btn-red" onclick="parentNode.parentNode.parentNode.parentNode.style.display=\'none\'">关闭</a> <a id="submit" class="nui-btn nui-btn-default">发送</a> </span></div> </div> </div> ';var i=document.createElement("div");i.innerHTML=n;document.body.appendChild(i);nui.open({content:"",shadow:false,success:function(){}});var r=$(".__ch");r.on("click","img",function(){nui.open({content:"<img src="+this.getAttribute("src")+">",title:$(this).next("span").html()})});nui.util.drop($(".__c"),".__cc");var a=new t({box:r});var o=["有什么可以帮你的吗？"],c=0,d=setInterval(function(){var e=o[c];e?(a.send({text:e}),c++):clearInterval(d)},500);var l=$(".nui-textarea");var p=function(e){switch(!0){case e.indexOf("首页")!==-1:case e.indexOf("home")!==-1:nui.alert("跳转中...");setTimeout(function(){location.href="/na"},800);break;case e.indexOf("下载")!==-1:a.send({type:"zip",text:"resource/nui."+nui.v+".zip",me:!0});break;case e.indexOf("api")!==-1:case e.indexOf("API")!==-1:nui.alert("跳转中...");setTimeout(function(){location.href="temple/api.html"},800);break;default:nui.debounce(function(){a.send({text:e,me:!0});a.ai(e,function(e){a.send({text:e})})},100)();break}};var s=(nui.store("_Chat_History_Text")||{}).text;var u=function(){var e=l.val()||"";if(""!==e.replace(/\s/g,"")){nui.store("_Chat_History_Text",{text:e});s=e;p(a.escape(e));l.val("")}};l.on("keydown",function(e){if(e.keyCode===13){return u(),false}if(e.keyCode===38&&this.value===""&&s){return this.value=s,false}});$("#submit").on("click",u);r.parent().hide();t.form=function(e){e.on("submit",function(){r.parent().show();var t=e.find("input");p(a.escape(t.val()));t.val("");return false})};window.nui["models/chat.js"]=t.form}();