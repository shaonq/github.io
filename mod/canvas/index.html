<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width"/>
    <link rel="stylesheet" href="../../nui/css/nui.min.css">
    <title>浏览器截图</title>
    <style>html,body{width:100%;height:2000px;background-image: linear-gradient(to bottom, #fff,#000);}</style>
</head>
<body>
<a style="position: absolute;right: 5%;top:5%;" class="nui-btn nui-btn-red">截图</a>
<a style="position: fixed;right: 5%;bottom:5%;" class="nui-btn nui-btn-green">反馈</a>

</body>
<script src="../../js/sea.js"></script>
<script src="../../js/sea-config.js"></script>
<script>
    document.querySelector(".nui-btn-red").onclick = function () {
        typeof Worker ? seajs.use(["nui", "cdn/html2canvas/0.5.0-beta1/html2canvas.min"], function (nui) {
                html2canvas(document.body).then(function (canvas) {
                    nui.open({
                        title: "截图内容",
                        fixed: true,
                        width: "100px",
                        content: '<img src="' + (canvas.toDataURL("image/png")) + '" width="100%">'
                    })

                });
            }) : alert("你的破浏览器不支持");
    };
    document.querySelector(".nui-btn-green").onclick = function () {
        typeof Worker ? seajs.use(["nui", "cdn/html2canvas/0.5.0-beta1/html2canvas.min"], function (nui) {
                var tagg=function(a){function b(a){if(1==m){e(a),j.push(1),g.save(),g.translate(g.canvas.width/2,g.canvas.height/2),g.translate(-g.canvas.width/2,-g.canvas.height/2),g.beginPath(),g.lineWidth=5+10*Math.random();for(var b=1;b<h.length;b++)k=h[b],l=i[b],0==j[b]?g.moveTo(k,l):g.lineTo(k,l);g.lineCap="round",g.lineWidth=3*f,g.strokeStyle="red",g.stroke(),g.restore()}}function c(a){m=1,e(a),j.push(0)}function d(a){m=0,e(a),j.push(0)}var f,g,h,i,j,k,l,m,e=function(b){var c=a.width,d=a.height,e=a.offsetWidth,f=a.offsetHeight;h.push(b.offsetX/e*c),i.push(b.offsetY/f*d)};a.addEventListener("mousemove",b,!1),a.addEventListener("mousedown",c,!1),a.addEventListener("mouseup",d,!1),f=a.width/a.offsetWidth,g=a.getContext("2d"),h=[],i=[],j=[],k=-1,l=-1,m=0};
                html2canvas(document.body).then(function (o) {
                    nui.open({
                        title: "标记反馈",
                        fixed: true,
                        width: "100px",
                        content: '<canvas class="canvas" style="width: 100%;cursor: crosshair;"></canvas>',
                        success: function () {
                            var canvas = document.querySelector(".canvas"),
                                n = window.innerHeight, //窗口的高
                                r = window.scrollY,  //y轴滚动条
                                t = window.innerWidth;  //文档宽度
                            canvas.width = t, canvas.height = n;    //画布宽高
                            canvas.getContext("2d").drawImage(o, 0, 0, t, n, 0, 0, t, n);
                            tagg(canvas)
                        }
                    })

                });
            }) : alert("你的破浏览器不支持");
    };
    /*  备选 "http://www.bootcdn.cn/rasterizehtml/ */
</script>
</html>